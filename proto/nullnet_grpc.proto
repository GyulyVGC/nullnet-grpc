syntax = "proto3";

package nullnet_grpc;

service NullnetGrpc {
  // TAP-based clients APIs --------------------------------------------------------------------------------------------

  // Control channel
  rpc ControlChannel(stream Empty) returns (stream VlanSetup);

  // Services list
  rpc ServicesList(Services) returns (Empty);

  // Proxy-based clients APIs ------------------------------------------------------------------------------------------

  // Proxy
  rpc Proxy(ProxyRequest) returns (Upstream);
}

// TAP-based clients ---------------------------------------------------------------------------------------------------

message VlanSetup {
  string target_ip = 1;
  string veth_ip = 2;
  uint32 vlan_id = 3;
  optional HostMapping host_mapping = 4;
}

message Services {
  repeated Service services = 1;
}

message Service {
  string name = 1;
  uint32 port = 2;
  repeated string dependencies = 3;
}

message HostMapping {
  string ip = 1;
  string name = 2;
}

// Proxy-based clients -------------------------------------------------------------------------------------------------

message ProxyRequest {
  string service_name = 1;
}

message Upstream {
  string ip = 1;
  uint32 port = 2;
}

// Misc ----------------------------------------------------------------------------------------------------------------

message Empty { }